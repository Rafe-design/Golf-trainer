<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ultimate Golf Trainer</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a1628;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;color:#e2e8f0;min-height:100vh}
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
input[type=number]{-moz-appearance:textfield}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:#111d33}::-webkit-scrollbar-thumb{background:#1e3a5f;border-radius:3px}
.header{background:#111d33;border-bottom:1px solid #1e3a5f;padding:14px 40px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}
.header-brand{display:flex;align-items:center;gap:10px}
.header-brand span.logo{font-size:24px}.header-brand span.title{font-size:18px;font-weight:700}
.header-brand span.badge{color:#22c55e;font-size:12px;font-weight:600;background:rgba(34,197,94,0.1);padding:2px 8px;border-radius:6px}
.nav{display:flex;gap:6px}
.nav button{display:flex;align-items:center;gap:6px;padding:10px 18px;border-radius:8px;border:none;cursor:pointer;font-weight:500;font-size:14px;transition:all .2s;background:transparent;color:#64748b}
.nav button.active{background:rgba(34,197,94,0.1);color:#22c55e}
.nav button:hover:not(.active){background:rgba(255,255,255,0.03)}
.content{max-width:1280px;margin:0 auto;padding:32px 40px}
.card{background:#111d33;border:1px solid #1e3a5f;border-radius:12px;padding:24px;transition:all .2s}
.card:hover.hoverable{background:#162440}
.grid{display:grid;gap:20px}.grid-2{grid-template-columns:repeat(2,1fr)}.grid-3{grid-template-columns:repeat(3,1fr)}.grid-4{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
.grid-cards{grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}
.flex{display:flex}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-between{justify-content:space-between}.gap-8{gap:8px}.gap-12{gap:12px}.gap-16{gap:16px}.gap-20{gap:20px}.flex-wrap{flex-wrap:wrap}
.text-center{text-align:center}
.mb-4{margin-bottom:4px}.mb-8{margin-bottom:8px}.mb-12{margin-bottom:12px}.mb-16{margin-bottom:16px}.mb-20{margin-bottom:20px}.mb-24{margin-bottom:24px}.mb-28{margin-bottom:28px}.mt-20{margin-top:20px}.mt-24{margin-top:24px}.mt-32{margin-top:32px}
h2{font-size:26px;margin:0}h3{font-size:16px;margin:0}
.text-dim{color:#94a3b8}.text-muted{color:#64748b}.text-sm{font-size:13px}.text-xs{font-size:12px}.text-lg{font-size:18px}
.font-bold{font-weight:700}.font-semi{font-weight:600}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:8px;border:none;font-weight:600;font-size:14px;cursor:pointer;transition:all .2s}
.btn-primary{background:#22c55e;color:#fff}.btn-primary:hover{background:#16a34a}
.btn-secondary{background:#3b82f6;color:#fff}.btn-secondary:hover{background:#2563eb}
.btn-ghost{background:transparent;color:#e2e8f0}.btn-ghost:hover{background:rgba(255,255,255,0.05)}
.btn-outline{background:transparent;color:#22c55e;border:1px solid #22c55e}.btn-outline:hover{background:rgba(34,197,94,0.1)}
.btn-sm{padding:6px 12px;font-size:13px}.btn-lg{padding:14px 28px;font-size:16px}
.badge{padding:3px 10px;border-radius:20px;font-size:12px;font-weight:600;display:inline-block}
.input{background:#0f1d32;color:#e2e8f0;border:1px solid #1e3a5f;border-radius:8px;padding:10px 14px;font-size:14px;outline:none;width:100%}
select.input{-webkit-appearance:none;appearance:none}
.stat-card{display:flex;align-items:center;gap:16px}
.stat-icon{width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:22px}
.stat-value{font-size:28px;font-weight:700;color:#e2e8f0}
.stat-label{font-size:13px;color:#94a3b8;margin-bottom:4px}
.modal-overlay{position:fixed;inset:0;z-index:1000;display:flex;align-items:center;justify-content:center}
.modal-bg{position:absolute;inset:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(4px)}
.modal-content{position:relative;background:#111d33;border:1px solid #1e3a5f;border-radius:16px;padding:28px;max-width:520px;width:90%;max-height:85vh;overflow-y:auto}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-close{background:none;border:none;color:#94a3b8;cursor:pointer;padding:4px;font-size:18px}
.progress-bar{height:4px;background:#0f1d32;border-radius:2px;margin-top:8px;overflow:hidden}
.progress-fill{height:4px;border-radius:2px;transition:width .5s}
table{width:100%;border-collapse:collapse}
th{color:#64748b;font-size:11px;font-weight:600;padding:8px 4px;text-align:center;border-bottom:1px solid #1e3a5f}
td{text-align:center;padding:6px 4px}
td input[type=number]{width:44px;background:#0f1d32;border:1px solid #1e3a5f;border-radius:6px;padding:4px;font-size:13px;text-align:center;color:#94a3b8;outline:none}
td select{background:#0f1d32;color:#94a3b8;border:1px solid #1e3a5f;border-radius:6px;padding:4px 8px;font-size:13px;text-align:center;outline:none}
td input[type=checkbox]{accent-color:#22c55e;width:16px;height:16px;cursor:pointer}
.hole-count-btn{flex:1;padding:8px 0;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px;transition:all .2s}
.category-btn{padding:6px 16px;border-radius:20px;cursor:pointer;font-size:13px;font-weight:500;transition:all .2s;border:1px solid #1e3a5f;background:transparent;color:#94a3b8}
.category-btn.active{border-color:#22c55e;background:rgba(34,197,94,0.1);color:#22c55e}
.phase-btn{padding:8px 18px;border-radius:10px;cursor:pointer;font-size:13px;font-weight:600;display:flex;align-items:center;gap:6px;transition:all .2s;border:1px solid #1e3a5f;background:transparent;color:#94a3b8}
.drill-card{cursor:pointer}.drill-card:hover{background:#162440}
.rating-btn{width:40px;height:40px;border-radius:50%;font-weight:700;cursor:pointer;font-size:14px;transition:all .2s}
.timer-display{font-size:56px;font-weight:700;font-family:monospace;margin-bottom:16px}
/* Simple chart styles */
.chart-container{position:relative;padding:8px 0}
.bar-chart{display:flex;align-items:flex-end;gap:6px;height:200px;padding:0 8px}
.bar-col{display:flex;flex-direction:column;align-items:center;flex:1;gap:4px;height:100%}
.bar{border-radius:4px 4px 0 0;transition:height .5s;min-width:8px;width:100%;max-width:40px;align-self:flex-end}
.bar-label{font-size:10px;color:#64748b;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px}
.line-chart-svg{width:100%;height:220px}
.chart-empty{height:200px;display:flex;align-items:center;justify-content:center;color:#64748b;font-size:13px}
.hidden{display:none}
@media(max-width:768px){.grid-2,.grid-3{grid-template-columns:1fr}.nav button span.nav-label{display:none}}
</style>
</head>
<body>

<div class="header">
  <div class="header-brand">
    <span class="logo">&#127948;&#65039;</span>
    <span class="title">Ultimate Golf Trainer</span>
    <span class="badge">PRO</span>
  </div>
  <div class="nav" id="nav"></div>
</div>
<div class="content" id="app"></div>

<script>
// ─── State ───────────────────────────────────────────────────────────
let state = {
  page: 'dashboard',
  rounds: [],
  drillSessions: [],
  showModal: false,
  activeDrill: null,
  timerRunning: false,
  elapsed: 0,
  drillComplete: false,
  rating: 3,
  categoryFilter: 'All',
  tipCategory: 'Setup',
  courseName: '',
  holeCount: 18,
  holes: makeHoles(),
};
let timerInterval = null;

function makeHoles() {
  return Array.from({length:18},(_,i)=>({hole:i+1,par:4,score:4,putts:2,fairway:false,gir:false}));
}

function generateId(){return Math.random().toString(36).slice(2,11)}
function formatDate(d){return new Date(d).toLocaleDateString('en-US',{month:'short',day:'numeric'})}

// ─── Data ────────────────────────────────────────────────────────────
const DRILLS = [
  {id:1,name:"Gate Putting Drill",category:"Putting",duration:15,difficulty:"Beginner",description:"Place two tees just wider than your putter head 6 inches in front of the ball. Stroke putts through the gate from 3, 6, and 10 feet.",goal:"Make 5 in a row from each distance."},
  {id:2,name:"Clock Drill",category:"Putting",duration:20,difficulty:"Intermediate",description:"Place 8 balls in a circle around the hole at 4 feet. Work your way around the clock making each putt.",goal:"Complete the full clock without missing."},
  {id:3,name:"Lag Putting Ladder",category:"Putting",duration:15,difficulty:"Advanced",description:"Putt to targets at 20, 30, 40, and 50 feet. Each ball must finish past the previous one but within 3 feet of the target.",goal:"Complete the ladder 3 times."},
  {id:4,name:"Pitch to Towel",category:"Short Game",duration:20,difficulty:"Beginner",description:"Place a towel at 20, 40, and 60 yards. Hit 10 balls to each target trying to land on the towel.",goal:"Land 3 out of 10 on the towel at each distance."},
  {id:5,name:"Up & Down Challenge",category:"Short Game",duration:25,difficulty:"Intermediate",description:"Drop balls in various lies around the green. Chip and putt, tracking your up-and-down percentage.",goal:"Convert 6 out of 10 up-and-downs."},
  {id:6,name:"Flop Shot Practice",category:"Short Game",duration:15,difficulty:"Advanced",description:"Set up with an open face over a bunker to a tight pin. Practice high, soft flop shots that land and stop.",goal:"Land 5 out of 10 within 6 feet."},
  {id:7,name:"Alignment Stick Drill",category:"Ball Striking",duration:20,difficulty:"Beginner",description:"Place alignment sticks on the ground for target line and foot line. Hit mid-irons focusing on square alignment.",goal:"Hit 20 balls with consistent alignment."},
  {id:8,name:"9-Shot Drill",category:"Ball Striking",duration:30,difficulty:"Advanced",description:"Hit 9 shots with the same club: low/mid/high trajectory combined with draw/straight/fade.",goal:"Successfully execute all 9 shot shapes."},
  {id:9,name:"Stock Shot Repetition",category:"Ball Striking",duration:20,difficulty:"Intermediate",description:"Pick one club and hit 30 balls focusing on repeating your stock shot shape and distance.",goal:"Land 20 of 30 within your target zone."},
  {id:10,name:"Fairway Finder",category:"Driving",duration:20,difficulty:"Beginner",description:"Pick a target fairway width on the range. Hit 20 drives trying to keep every ball within that window.",goal:"Hit 14 out of 20 in the fairway zone."},
  {id:11,name:"Driver Dispersion",category:"Driving",duration:25,difficulty:"Intermediate",description:"Hit 20 drives and mentally note where each lands. Focus on tightening your dispersion pattern.",goal:"Keep 15 out of 20 within a 30-yard spread."},
  {id:12,name:"Bomb & Control",category:"Driving",duration:20,difficulty:"Advanced",description:"Alternate between swinging at 100% and 80%. Track distance difference and accuracy trade-off.",goal:"Find your optimal power-to-accuracy ratio."},
  {id:13,name:"Pre-Shot Routine",category:"Mental",duration:15,difficulty:"Beginner",description:"Practice your complete pre-shot routine before every shot on the range. Visualize, align, waggle, execute.",goal:"Complete 20 shots with full routine without rushing."},
  {id:14,name:"Pressure Putts",category:"Mental",duration:20,difficulty:"Advanced",description:"Create consequence for misses: if you miss, start over. Simulate tournament pressure on 5-footers.",goal:"Make 10 in a row before leaving."},
  {id:15,name:"Course Simulation",category:"Mental",duration:30,difficulty:"Intermediate",description:"Play a mental round on the range. Visualize each hole on your home course, select the right club, and commit.",goal:"Complete 18 holes with full visualization."},
];

const TIPS = [
  {category:"Setup",title:"Grip Pressure",tip:"Hold the club with a pressure of 4 out of 10. Too tight restricts wrist hinge and costs distance.",icon:"\u270a"},
  {category:"Setup",title:"Ball Position",tip:"Driver: inside front heel. Irons: gradually move back to center. Wedges: center of stance.",icon:"\u26aa"},
  {category:"Setup",title:"Posture",tip:"Bend from the hips, not the waist. Arms hang naturally. Slight knee flex. Weight on balls of feet.",icon:"\ud83e\uddcd"},
  {category:"Backswing",title:"One-Piece Takeaway",tip:"Start the swing with shoulders, arms, and club moving together as one unit for the first 18 inches.",icon:"\u21a9\ufe0f"},
  {category:"Backswing",title:"Full Turn",tip:"Rotate your shoulders 90\u00b0 while keeping your lower body stable. Feel your back face the target.",icon:"\ud83d\udd04"},
  {category:"Backswing",title:"Wrist Hinge",tip:"Allow wrists to hinge naturally by the time your hands reach waist height. Don't force or delay it.",icon:"\ud83e\udd32"},
  {category:"Downswing",title:"Start From Ground",tip:"Initiate the downswing with a slight lateral shift of the hips toward the target, then rotate.",icon:"\u2b07\ufe0f"},
  {category:"Downswing",title:"Lag Retention",tip:"Maintain the angle between your lead arm and club shaft as long as possible for maximum speed at impact.",icon:"\ud83d\udcd0"},
  {category:"Impact",title:"Hands Ahead",tip:"At impact, your hands should be ahead of the ball with irons, creating a descending blow and compression.",icon:"\ud83d\udc4b"},
  {category:"Impact",title:"Divot After Ball",tip:"For iron shots, the lowest point of your swing should be 2-4 inches in front of the ball.",icon:"\u26f3"},
  {category:"Follow Through",title:"Full Extension",tip:"After impact, let both arms fully extend toward the target. This ensures you're releasing the club properly.",icon:"\u27a1\ufe0f"},
  {category:"Follow Through",title:"Balanced Finish",tip:"Hold your finish: weight on front foot, belt buckle facing target, back toe on the ground. If you can't hold it, you swung too hard.",icon:"\ud83c\udfcc\ufe0f"},
];

const PRO_TIPS = [
  {tip:"The best players in the world miss greens — what separates them is their ability to get up and down. Spend 50% of your practice time inside 100 yards.",category:"Strategy",icon:"\ud83e\udde0"},
  {tip:"Before every shot, pick the smallest possible target. A branch, a discoloration in the fairway, a specific edge of the green. Vague targets produce vague results.",category:"Mental",icon:"\ud83c\udfaf"},
  {tip:"Your grip is the only connection to the club. Check it before every session: V's formed by thumb and forefinger should point between your chin and right shoulder.",category:"Fundamentals",icon:"\u270b"},
  {tip:"On the putting green, pace is more important than line. A putt with perfect pace will fall from more angles than a putt hit too firm on the right line.",category:"Putting",icon:"\u26f3"},
  {tip:"When you're struggling with your driver, tee it lower and swing at 80%. Control beats distance on every scorecard.",category:"Course Mgmt",icon:"\ud83d\udcc9"},
  {tip:"Film your swing from two angles: face-on and down-the-line. You can't fix what you can't see, and feel is almost never real.",category:"Practice",icon:"\ud83c\udfa5"},
  {tip:"Play the shot you know you can hit, not the one you hit that one time. Course management is about probability, not possibility.",category:"Strategy",icon:"\ud83c\udfc6"},
  {tip:"In a greenside bunker, commit to hitting 2 inches behind the ball and accelerating through. Deceleration is the #1 cause of bunker disasters.",category:"Short Game",icon:"\ud83c\udfd6\ufe0f"},
  {tip:"Warm up with wedges, not driver. Start with 30-yard pitches and gradually build to full swings. This builds tempo and saves your body.",category:"Practice",icon:"\ud83d\udd25"},
  {tip:"When reading a putt, walk to the low side first. You'll see the break far more clearly from below the hole than from behind the ball.",category:"Putting",icon:"\ud83d\udc40"},
  {tip:"Your pre-shot routine should take the same amount of time on every shot — whether it's a 3-foot putt or a 300-yard drive. Consistency breeds confidence.",category:"Mental",icon:"\u23f1\ufe0f"},
  {tip:"Focus on your breathing between shots. A deep breath before you step into the ball lowers cortisol and keeps your muscles relaxed under pressure.",category:"Mental",icon:"\ud83c\udf2c\ufe0f"},
  {tip:"When chipping, keep your weight 60/40 on your front foot throughout the stroke. Let the bounce of the club do the work, not your wrists.",category:"Short Game",icon:"\u2b50"},
  {tip:"Know your actual carry distances, not your best-ever distances. Track them on the range with a launch monitor or GPS. Most amateurs over-estimate by 10-15 yards.",category:"Strategy",icon:"\ud83d\udccc"},
  {tip:"On windy days, club up and swing easy. A smooth 7-iron flies straighter and more predictably than a hard 8-iron in the wind.",category:"Course Mgmt",icon:"\ud83d\udca8"},
  {tip:"When you're between clubs, take the longer one and choke down half an inch. You'll swing smoother and make better contact.",category:"Fundamentals",icon:"\ud83d\udd27"},
  {tip:"Practice with a purpose. Every range session should have a specific goal — don't just beat balls. Write your plan down before you start.",category:"Practice",icon:"\ud83d\udcdd"},
  {tip:"The follow-through reveals everything about impact. If you finish in balance with your chest facing the target, you made a good swing.",category:"Fundamentals",icon:"\ud83c\udfcc\ufe0f"},
  {tip:"When facing a downhill lie, set your shoulders parallel to the slope and play the ball back in your stance. Swing along the slope, not into it.",category:"Shot Making",icon:"\u26f0\ufe0f"},
  {tip:"The fastest way to lower your handicap is to eliminate penalty strokes. Take your medicine, punch out sideways, and save bogey instead of making double.",category:"Course Mgmt",icon:"\ud83d\udea8"},
  {tip:"After a bad hole, take 3 deep breaths before teeing up on the next. The best round of your life might start on any hole — don't let one bad hole become three.",category:"Mental",icon:"\ud83e\uddd8"},
  {tip:"Hit to the fat side of the green. Missing a green on the short side leaves the hardest up-and-down. The middle of the green is always a good miss.",category:"Strategy",icon:"\ud83d\udfe2"},
  {tip:"Work on your 4-foot putts until they feel automatic. Tour players make 90% from 4 feet. If you can make these consistently, you'll save 3-5 strokes per round.",category:"Putting",icon:"\ud83d\udd73\ufe0f"},
  {tip:"Your body needs to be golf-fit. Hip mobility, thoracic rotation, and glute strength are the three physical attributes that most affect your swing.",category:"Fitness",icon:"\ud83d\udcaa"},
  {tip:"Track your stats for 10 rounds before deciding what to practice. Data will often reveal a different weakness than what you feel on the course.",category:"Strategy",icon:"\ud83d\udcca"},
  {tip:"On fast greens, grip down on your putter by an inch. It shortens the pendulum, giving you more control over speed on slippery surfaces.",category:"Putting",icon:"\ud83c\udfa2"},
  {tip:"When it's raining, grip pressure matters more than ever. Keep a dry towel in your bag and dry your grips between every shot.",category:"Course Mgmt",icon:"\ud83c\udf27\ufe0f"},
  {tip:"Learn to hit a reliable shot shape — draw or fade — and play it on every full swing. A predictable curve is far more valuable than trying to hit it straight.",category:"Shot Making",icon:"\u27b0"},
  {tip:"The transition from backswing to downswing is the most important moment in golf. Feel like there's a slight pause at the top — let gravity start the club down.",category:"Fundamentals",icon:"\u23f8\ufe0f"},
  {tip:"Never aim at a hazard and try to work the ball away from it. Aim away from trouble and let your shot shape be insurance, not the primary plan.",category:"Course Mgmt",icon:"\ud83d\udee1\ufe0f"},
];

// ─── Helpers ─────────────────────────────────────────────────────────
const diffColors = {Beginner:'#22c55e',Intermediate:'#f59e0b',Advanced:'#ef4444'};
const phaseColors = {Setup:'#22c55e',Backswing:'#3b82f6',Downswing:'#a855f7',Impact:'#f59e0b','Follow Through':'#ec4899'};
const phaseIcons = {Setup:'\ud83c\udfaf',Backswing:'\u21a9\ufe0f',Downswing:'\u2b07\ufe0f',Impact:'\ud83d\udca5','Follow Through':'\ud83c\udfcc\ufe0f'};

function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}

function scoreToPar(score,par){
  const diff=score-par;
  if(diff<=-2)return{color:'#facc15'};
  if(diff===-1)return{color:'#22c55e'};
  if(diff===0)return{color:'#94a3b8'};
  if(diff===1)return{color:'#f59e0b'};
  return{color:'#ef4444'};
}

// ─── Simple SVG Charts ───────────────────────────────────────────────
function makeBarChart(data,valueKey,labels,color,height=160){
  if(!data.length)return '<div class="chart-empty">No data yet</div>';
  const max=Math.max(...data.map(d=>Math.abs(d[valueKey])),1);
  let bars='';
  data.forEach((d,i)=>{
    const val=d[valueKey];
    const h=Math.max(4,(Math.abs(val)/max)*height*0.85);
    const c=typeof color==='function'?color(d,i):color;
    bars+=`<div class="bar-col"><div class="bar" style="height:${h}px;background:${c}"></div><div class="bar-label">${esc(d[labels]||'')}</div></div>`;
  });
  return `<div class="bar-chart" style="height:${height}px">${bars}</div>`;
}

function makeLineChart(data,keys,colors,labels,height=160){
  if(data.length<2)return '<div class="chart-empty">Need more data</div>';
  const allVals=data.flatMap(d=>keys.map(k=>d[k]||0));
  const min=Math.min(...allVals);const max=Math.max(...allVals);
  const range=max-min||1;
  const w=100;const pad=8;
  const usableW=w-pad*2;const usableH=height-40;

  let svg=`<svg viewBox="0 0 ${w} ${height}" class="line-chart-svg" preserveAspectRatio="none">`;
  keys.forEach((key,ki)=>{
    let points=data.map((d,i)=>{
      const x=pad+((i/(data.length-1))*usableW);
      const y=10+usableH-(((d[key]||0)-min)/range)*usableH;
      return `${x},${y}`;
    });
    svg+=`<polyline points="${points.join(' ')}" fill="none" stroke="${colors[ki]}" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round"/>`;
    data.forEach((d,i)=>{
      const x=pad+((i/(data.length-1))*usableW);
      const y=10+usableH-(((d[key]||0)-min)/range)*usableH;
      svg+=`<circle cx="${x}" cy="${y}" r="1.2" fill="${colors[ki]}"/>`;
    });
  });
  // X labels
  data.forEach((d,i)=>{
    const x=pad+((i/(data.length-1))*usableW);
    svg+=`<text x="${x}" y="${height-2}" text-anchor="middle" font-size="3" fill="#64748b">${esc(d[labels])}</text>`;
  });
  svg+=`</svg>`;
  return svg;
}

// ─── Radar Chart ─────────────────────────────────────────────────────
function makeRadarChart(data,size=220){
  if(!data.length)return '';
  const cx=size/2,cy=size/2,r=size*0.38;
  const n=data.length;
  let svg=`<svg viewBox="0 0 ${size} ${size}" width="100%" style="max-width:${size}px;margin:0 auto;display:block">`;
  // Grid
  [0.25,0.5,0.75,1].forEach(s=>{
    let pts=data.map((_,i)=>{const a=(Math.PI*2*i/n)-Math.PI/2;return `${cx+r*s*Math.cos(a)},${cy+r*s*Math.sin(a)}`;});
    svg+=`<polygon points="${pts.join(' ')}" fill="none" stroke="#1e3a5f" stroke-width="0.5"/>`;
  });
  // Axes + Labels
  data.forEach((d,i)=>{
    const a=(Math.PI*2*i/n)-Math.PI/2;
    const x2=cx+r*Math.cos(a),y2=cy+r*Math.sin(a);
    svg+=`<line x1="${cx}" y1="${cy}" x2="${x2}" y2="${y2}" stroke="#1e3a5f" stroke-width="0.5"/>`;
    const lx=cx+(r+14)*Math.cos(a),ly=cy+(r+14)*Math.sin(a);
    svg+=`<text x="${lx}" y="${ly}" text-anchor="middle" dominant-baseline="middle" font-size="9" fill="#94a3b8">${esc(d.skill)}</text>`;
  });
  // Data polygon
  let pts=data.map((d,i)=>{const v=Math.min(100,Math.max(0,d.value))/100;const a=(Math.PI*2*i/n)-Math.PI/2;return `${cx+r*v*Math.cos(a)},${cy+r*v*Math.sin(a)}`;});
  svg+=`<polygon points="${pts.join(' ')}" fill="rgba(34,197,94,0.15)" stroke="#22c55e" stroke-width="1.5"/>`;
  pts.split='';
  data.forEach((d,i)=>{const v=Math.min(100,Math.max(0,d.value))/100;const a=(Math.PI*2*i/n)-Math.PI/2;svg+=`<circle cx="${cx+r*v*Math.cos(a)}" cy="${cy+r*v*Math.sin(a)}" r="3" fill="#22c55e"/>`;});
  svg+=`</svg>`;
  return svg;
}

// ─── Render Functions ────────────────────────────────────────────────
function render(){
  renderNav();
  const app=document.getElementById('app');
  switch(state.page){
    case 'dashboard':app.innerHTML=renderDashboard();break;
    case 'scores':app.innerHTML=renderScores();break;
    case 'drills':app.innerHTML=renderDrills();break;
    case 'tips':app.innerHTML=renderTips();break;
    case 'stats':app.innerHTML=renderStats();break;
  }
  bindEvents();
}

function renderNav(){
  const items=[
    {id:'dashboard',label:'Dashboard',icon:'&#8962;'},
    {id:'scores',label:'Scores',icon:'&#9998;'},
    {id:'drills',label:'Drills',icon:'&#9678;'},
    {id:'tips',label:'Tips',icon:'&#9733;'},
    {id:'stats',label:'Stats',icon:'&#9636;'},
  ];
  document.getElementById('nav').innerHTML=items.map(i=>
    `<button data-page="${i.id}" class="${state.page===i.id?'active':''}">${i.icon} <span class="nav-label">${i.label}</span></button>`
  ).join('');
}

function renderDashboard(){
  const R=state.rounds,D=state.drillSessions,n=R.length;
  const avg=n?(R.reduce((s,r)=>s+r.totalScore,0)/n).toFixed(1):'\u2014';
  const best=n?Math.min(...R.map(r=>r.totalScore)):'\u2014';
  const pracMin=D.reduce((s,d)=>s+d.duration,0);
  const avgFW=n?(R.reduce((s,r)=>s+(r.fairwaysHit||0),0)/n).toFixed(1):'\u2014';
  const avgGIR=n?(R.reduce((s,r)=>s+(r.gir||0),0)/n).toFixed(1):'\u2014';
  const avgPutts=n?(R.reduce((s,r)=>s+(r.totalPutts||0),0)/n).toFixed(1):'\u2014';

  let html='';
  // Daily Pro Tip
  const dayIndex=Math.floor(Date.now()/86400000)%PRO_TIPS.length;
  const proTip=PRO_TIPS[dayIndex];
  const catColors={Strategy:'#3b82f6',Mental:'#a855f7',Fundamentals:'#22c55e',Putting:'#f59e0b','Course Mgmt':'#ec4899',Practice:'#06b6d4','Short Game':'#f97316','Shot Making':'#8b5cf6',Fitness:'#ef4444'};
  const tipColor=catColors[proTip.category]||'#f59e0b';
  html+=`<div class="card mb-28" style="background:linear-gradient(135deg, ${tipColor}08, ${tipColor}03);border:1px solid ${tipColor}30;padding:28px 32px"><div class="flex gap-20 items-center" style="flex-wrap:wrap"><div style="font-size:40px;flex-shrink:0;width:56px;height:56px;border-radius:14px;background:${tipColor}15;display:flex;align-items:center;justify-content:center">${proTip.icon}</div><div style="flex:1;min-width:240px"><div class="flex items-center gap-8 mb-8"><span style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;font-weight:700;color:${tipColor}">Daily Pro Tip</span><span class="badge" style="background:${tipColor}22;color:${tipColor}">${proTip.category}</span></div><p style="font-size:15px;line-height:1.7;color:#e2e8f0;margin:0">${esc(proTip.tip)}</p></div></div></div>`;
  html+=`<div class="mb-28"><h2>Dashboard</h2><p class="text-dim text-sm" style="margin-top:4px">Your golf performance at a glance</p></div>`;
  html+=`<div class="grid grid-4 mb-28">`;
  html+=statCard('Rounds Played',n,'\ud83d\udea9','#22c55e');
  html+=statCard('Avg Score',avg,'\ud83d\udcca','#3b82f6');
  html+=statCard('Best Round',best,'\ud83c\udfc6','#f59e0b');
  html+=statCard('Practice Time',pracMin+'m','\u23f1','#a855f7');
  html+=`</div>`;

  if(n>0){
    const scoreData=R.slice(-10).map(r=>({name:formatDate(r.date),score:r.totalScore,par:r.totalPar}));
    const radarData=[
      {skill:'Driving',value:Math.min(100,(avgFW/14)*100)},
      {skill:'Approach',value:Math.min(100,(avgGIR/18)*100)},
      {skill:'Putting',value:Math.min(100,Math.max(0,(1-(avgPutts-28)/12)*100))},
      {skill:'Scoring',value:Math.min(100,Math.max(0,(1-(avg-72)/36)*100))},
      {skill:'Practice',value:Math.min(100,(pracMin/300)*100)},
    ];
    html+=`<div class="grid grid-2 mb-20">`;
    html+=`<div class="card"><h3 class="mb-16">Score Trend</h3>${makeLineChart(scoreData,['score','par'],['#22c55e','#64748b'],'name',220)}</div>`;
    html+=`<div class="card"><h3 class="mb-16">Skill Radar</h3>${makeRadarChart(radarData,260)}</div>`;
    html+=`</div>`;
    html+=`<div class="grid grid-3 mt-20">`;
    html+=progressCard('Avg Fairways Hit',avgFW+' / 14',(avgFW/14)*100,'#22c55e');
    html+=progressCard('Avg GIR',avgGIR+' / 18',(avgGIR/18)*100,'#3b82f6');
    html+=progressCard('Avg Putts',avgPutts,Math.max(0,(1-(avgPutts-26)/16)*100),'#f59e0b');
    html+=`</div>`;
    // Recent rounds summary
    const recent=R.slice(-3).reverse();
    html+=`<div class="mt-20"><h3 class="mb-16" style="font-size:15px">Recent Rounds</h3><div class="grid grid-3">`;
    recent.forEach(r=>{
      const diff=r.totalScore-r.totalPar;const diffStr=diff===0?'E':diff>0?'+'+diff:''+diff;const c=diff<=0?'#22c55e':'#f59e0b';
      html+=`<div class="card"><div class="flex items-center gap-12 mb-12"><div style="width:40px;height:40px;border-radius:10px;background:${c}15;display:flex;align-items:center;justify-content:center;color:${c};font-weight:800;font-size:16px">${diffStr}</div><div><div style="color:#e2e8f0;font-weight:600;font-size:14px">${esc(r.course)}</div><div class="text-muted text-xs">${formatDate(r.date)}</div></div></div><div class="flex justify-between" style="padding-top:12px;border-top:1px solid #1e3a5f"><div class="text-center"><div style="color:#e2e8f0;font-weight:700;font-size:18px">${r.totalScore}</div><div class="text-muted" style="font-size:10px">Score</div></div><div class="text-center"><div class="text-dim" style="font-size:14px">${r.totalPutts}</div><div class="text-muted" style="font-size:10px">Putts</div></div><div class="text-center"><div class="text-dim" style="font-size:14px">${r.fairwaysHit}/14</div><div class="text-muted" style="font-size:10px">FW</div></div><div class="text-center"><div class="text-dim" style="font-size:14px">${r.gir}/18</div><div class="text-muted" style="font-size:10px">GIR</div></div></div></div>`;
    });
    html+=`</div></div>`;
  } else {
    // Welcome state with quick actions and tips
    html+=`<div class="grid grid-2 mb-20">`;
    html+=`<div class="card text-center" style="padding:48px"><div style="font-size:56px;margin-bottom:16px">\ud83c\udfcc\ufe0f</div><h3 class="mb-8">Welcome to Ultimate Golf Trainer</h3><p class="text-dim" style="max-width:360px;margin:0 auto 20px">Track your scores, practice with structured drills, and watch your game improve over time.</p><button class="btn btn-primary" onclick="state.page='scores';render()">Log Your First Round</button></div>`;
    html+=`<div class="card"><h3 class="mb-16">Quick Start</h3><div class="flex flex-col gap-12">`;
    html+=`<div class="card" style="padding:16px;cursor:pointer;border:1px solid #1e3a5f" onclick="state.page='scores';render()"><div class="flex items-center gap-12"><div style="width:40px;height:40px;border-radius:10px;background:rgba(34,197,94,0.1);display:flex;align-items:center;justify-content:center;font-size:18px">\ud83d\udcdd</div><div><div style="font-weight:600;font-size:14px">Log a Round</div><div class="text-muted text-xs">Enter scores hole-by-hole with fairways, GIR, and putts</div></div></div></div>`;
    html+=`<div class="card" style="padding:16px;cursor:pointer;border:1px solid #1e3a5f" onclick="state.page='drills';render()"><div class="flex items-center gap-12"><div style="width:40px;height:40px;border-radius:10px;background:rgba(59,130,246,0.1);display:flex;align-items:center;justify-content:center;font-size:18px">\ud83c\udfaf</div><div><div style="font-weight:600;font-size:14px">Start a Drill</div><div class="text-muted text-xs">15 structured drills across 5 categories with a built-in timer</div></div></div></div>`;
    html+=`<div class="card" style="padding:16px;cursor:pointer;border:1px solid #1e3a5f" onclick="state.page='tips';render()"><div class="flex items-center gap-12"><div style="width:40px;height:40px;border-radius:10px;background:rgba(245,158,11,0.1);display:flex;align-items:center;justify-content:center;font-size:18px">\u2b50</div><div><div style="font-weight:600;font-size:14px">Swing Tips</div><div class="text-muted text-xs">Fundamentals for every phase from setup to follow through</div></div></div></div>`;
    html+=`</div></div>`;
    html+=`</div>`;
    // Suggested drills
    const suggested=DRILLS.filter(d=>d.difficulty==='Beginner').slice(0,3);
    html+=`<div class="mt-20"><h3 class="mb-16" style="font-size:15px">Suggested Drills to Get Started</h3><div class="grid grid-3">`;
    suggested.forEach(d=>{
      html+=`<div class="card drill-card" onclick="state.page='drills';state.activeDrill=DRILLS.find(x=>x.id===${d.id});state.elapsed=0;state.timerRunning=false;state.drillComplete=false;state.rating=3;clearInterval(timerInterval);render()"><div class="flex justify-between items-center mb-12"><span class="badge" style="background:${diffColors[d.difficulty]}22;color:${diffColors[d.difficulty]}">${d.difficulty}</span><span class="text-muted text-xs">~${d.duration} min</span></div><h3 style="font-size:15px;margin-bottom:4px">${esc(d.name)}</h3><p class="text-muted text-xs mb-12">${d.category}</p><p class="text-dim text-sm" style="line-height:1.5">${esc(d.description)}</p></div>`;
    });
    html+=`</div></div>`;
  }
  return html;
}

function statCard(label,value,icon,color){
  return `<div class="card stat-card"><div class="stat-icon" style="background:${color}15;color:${color}">${icon}</div><div><div class="stat-label">${label}</div><div class="stat-value">${value}</div></div></div>`;
}
function progressCard(label,value,pct,color){
  return `<div class="card"><div class="text-dim text-sm mb-4">${label}</div><div style="color:#e2e8f0;font-size:20px;font-weight:700">${value}</div><div class="progress-bar"><div class="progress-fill" style="width:${Math.min(100,pct)}%;background:${color}"></div></div></div>`;
}

// ─── Scores ──────────────────────────────────────────────────────────
function renderScores(){
  let html=`<div class="flex items-center justify-between mb-24"><div><h2>Score Tracker</h2><p class="text-dim text-sm" style="margin-top:4px">Log and review your rounds</p></div><button class="btn btn-primary" onclick="openNewRound()">+ New Round</button></div>`;
  if(!state.rounds.length){
    html+=`<div class="card text-center" style="padding:48px"><div style="font-size:48px;margin-bottom:16px">\ud83d\udcdd</div><h3 class="mb-8">No rounds logged yet</h3><p class="text-dim">Click "New Round" to log your first round.</p></div>`;
  } else {
    html+=`<div class="flex flex-col gap-12">`;
    [...state.rounds].reverse().forEach(r=>{
      const diff=r.totalScore-r.totalPar;
      const diffStr=diff===0?'E':diff>0?'+'+diff:''+diff;
      const c=diff<=0?'#22c55e':'#f59e0b';
      html+=`<div class="card hoverable"><div class="flex items-center justify-between" style="flex-wrap:wrap;gap:12px"><div class="flex items-center gap-16"><div style="width:48px;height:48px;border-radius:12px;background:${c}15;display:flex;align-items:center;justify-content:center;color:${c};font-weight:800;font-size:18px">${diffStr}</div><div><div style="color:#e2e8f0;font-weight:600;font-size:15px">${esc(r.course)}</div><div class="text-muted text-sm">${formatDate(r.date)} · ${r.holes} holes</div></div></div><div class="flex items-center gap-20"><div class="text-center"><div style="color:#e2e8f0;font-weight:700;font-size:20px">${r.totalScore}</div><div class="text-muted" style="font-size:11px">Score</div></div><div class="text-center"><div class="text-dim" style="font-size:16px">${r.totalPutts}</div><div class="text-muted" style="font-size:11px">Putts</div></div><div class="text-center"><div class="text-dim" style="font-size:16px">${r.fairwaysHit}/14</div><div class="text-muted" style="font-size:11px">FW</div></div><div class="text-center"><div class="text-dim" style="font-size:16px">${r.gir}/18</div><div class="text-muted" style="font-size:11px">GIR</div></div><button class="btn-ghost" style="border:none;cursor:pointer;color:#64748b;background:none;padding:4px" onclick="deleteRound('${r.id}')">\u2716</button></div></div></div>`;
    });
    html+=`</div>`;
  }
  if(state.showModal) html+=renderScoreModal();
  return html;
}

function renderScoreModal(){
  const ah=state.holes.slice(0,state.holeCount);
  let rows=ah.map((h,i)=>{
    const sp=scoreToPar(h.score,h.par);
    return `<tr><td style="color:#94a3b8;font-size:13px">${h.hole}</td><td><select onchange="updateHole(${i},'par',+this.value)">${[3,4,5].map(p=>`<option value="${p}"${h.par===p?' selected':''}>${p}</option>`).join('')}</select></td><td><input type="number" value="${h.score}" min="1" max="15" style="color:${sp.color};font-weight:700" onchange="updateHole(${i},'score',+this.value)"/></td><td><input type="number" value="${h.putts}" min="0" max="10" onchange="updateHole(${i},'putts',+this.value)"/></td><td><input type="checkbox" ${h.fairway?'checked':''} onchange="updateHole(${i},'fairway',this.checked)"/></td><td><input type="checkbox" ${h.gir?'checked':''} style="accent-color:#3b82f6" onchange="updateHole(${i},'gir',this.checked)"/></td></tr>`;
  }).join('');
  const total=ah.reduce((s,h)=>s+h.score,0);
  const totalPar=ah.reduce((s,h)=>s+h.par,0);

  return `<div class="modal-overlay"><div class="modal-bg" onclick="closeModal()"></div><div class="modal-content"><div class="modal-header"><h3>Log New Round</h3><button class="modal-close" onclick="closeModal()">\u2716</button></div><div class="mb-16"><label class="text-dim text-sm" style="display:block;margin-bottom:6px">Course Name</label><input class="input" value="${esc(state.courseName)}" placeholder="e.g., Pebble Beach" oninput="state.courseName=this.value"/></div><div class="mb-20"><label class="text-dim text-sm" style="display:block;margin-bottom:6px">Holes</label><div class="flex gap-8">${[9,18].map(n=>`<button class="hole-count-btn" style="border:1px solid ${state.holeCount===n?'#22c55e':'#1e3a5f'};background:${state.holeCount===n?'rgba(34,197,94,0.1)':'transparent'};color:${state.holeCount===n?'#22c55e':'#94a3b8'}" onclick="state.holeCount=${n};render()">${n} Holes</button>`).join('')}</div></div><div style="max-height:360px;overflow-y:auto;margin-bottom:20px"><table><thead><tr><th>#</th><th>Par</th><th>Score</th><th>Putts</th><th>FW</th><th>GIR</th></tr></thead><tbody>${rows}</tbody></table></div><div class="flex justify-between items-center" style="padding:12px 0;border-top:1px solid #1e3a5f"><div class="text-dim" style="font-size:14px">Total: <span style="color:#e2e8f0;font-weight:700;font-size:18px">${total}</span><span class="text-muted" style="margin-left:8px">(Par ${totalPar})</span></div><button class="btn btn-primary" onclick="saveRound()">Save Round</button></div></div></div>`;
}

// ─── Drills ──────────────────────────────────────────────────────────
function renderDrills(){
  if(state.activeDrill) return renderActiveDrill();
  const categories=['All',...new Set(DRILLS.map(d=>d.category))];
  const filtered=state.categoryFilter==='All'?DRILLS:DRILLS.filter(d=>d.category===state.categoryFilter);
  let html=`<div class="mb-24"><h2>Practice Drills</h2><p class="text-dim text-sm" style="margin-top:4px">Structured drills to sharpen every part of your game</p></div>`;
  html+=`<div class="flex gap-8 flex-wrap mb-20">${categories.map(c=>`<button class="category-btn${state.categoryFilter===c?' active':''}" onclick="state.categoryFilter='${c}';render()">${c}</button>`).join('')}</div>`;
  html+=`<div class="grid grid-cards">`;
  filtered.forEach(d=>{
    html+=`<div class="card drill-card" onclick="startDrill(${d.id})"><div class="flex justify-between items-center mb-12"><span class="badge" style="background:${diffColors[d.difficulty]}22;color:${diffColors[d.difficulty]}">${d.difficulty}</span><span class="text-muted text-xs">~${d.duration} min</span></div><h3 style="font-size:15px;margin-bottom:4px">${esc(d.name)}</h3><p class="text-muted text-xs mb-12">${d.category}</p><p class="text-dim text-sm" style="line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">${esc(d.description)}</p></div>`;
  });
  html+=`</div>`;
  if(state.drillSessions.length){
    html+=`<div class="mt-32"><h3 class="mb-16">Recent Sessions</h3><div class="flex flex-col gap-8">`;
    state.drillSessions.slice(-5).reverse().forEach(s=>{
      html+=`<div class="card" style="padding:14px"><div class="flex justify-between items-center"><div><span style="color:#e2e8f0;font-weight:600;font-size:14px">${esc(s.drillName)}</span><span class="text-muted text-xs" style="margin-left:8px">${formatDate(s.date)}</span></div><div class="flex items-center gap-12"><span class="text-dim text-sm">${s.duration}m</span><span style="color:#f59e0b;font-size:13px">${'\u2605'.repeat(s.rating)}${'\u2606'.repeat(5-s.rating)}</span></div></div></div>`;
    });
    html+=`</div></div>`;
  }
  return html;
}

function renderActiveDrill(){
  const d=state.activeDrill;
  const fmt=s=>String(Math.floor(s/60)).padStart(2,'0')+':'+String(s%60).padStart(2,'0');
  let html=`<button class="btn btn-ghost mb-16" onclick="state.activeDrill=null;state.timerRunning=false;clearInterval(timerInterval);render()">\u2190 Back to Drills</button>`;
  html+=`<div class="card"><div class="text-center"><span class="badge" style="background:${diffColors[d.difficulty]}22;color:${diffColors[d.difficulty]}">${d.difficulty}</span><h2 style="margin:12px 0 4px">${esc(d.name)}</h2><p class="text-dim text-sm">${d.category} · ~${d.duration} min</p></div>`;
  html+=`<div style="background:#0f1d32;border-radius:12px;padding:20px;margin:20px 0"><h4 style="color:#e2e8f0;margin:0 0 8px;font-size:14px">Instructions</h4><p class="text-dim text-sm" style="line-height:1.6;margin:0">${esc(d.description)}</p><h4 style="color:#e2e8f0;margin:16px 0 8px;font-size:14px">Goal</h4><p style="color:#22c55e;font-size:14px;margin:0;font-weight:600">${esc(d.goal)}</p></div>`;
  html+=`<div class="text-center" style="margin:24px 0"><div class="timer-display">${fmt(state.elapsed)}</div>`;
  if(!state.drillComplete){
    html+=`<div class="flex gap-12" style="justify-content:center"><button class="btn ${state.timerRunning?'btn-outline':'btn-primary'} btn-lg" onclick="toggleTimer()">${state.timerRunning?'\u23f8 Pause':state.elapsed>0?'\u25b6 Resume':'\u25b6 Start'}</button>`;
    if(state.elapsed>0) html+=`<button class="btn btn-secondary btn-lg" onclick="completeDrill()">\u2713 Complete</button>`;
    html+=`</div>`;
  } else {
    html+=`<p class="text-dim text-sm mb-12">How'd it go?</p><div class="flex gap-8 mb-20" style="justify-content:center">${[1,2,3,4,5].map(n=>`<button class="rating-btn" style="border:2px solid ${n<=state.rating?'#22c55e':'#1e3a5f'};background:${n<=state.rating?'#22c55e':'transparent'};color:${n<=state.rating?'#fff':'#64748b'}" onclick="state.rating=${n};render()">${n}</button>`).join('')}</div><button class="btn btn-primary btn-lg" onclick="saveDrillSession()">Save Session</button>`;
  }
  html+=`</div></div>`;
  return html;
}

// ─── Tips ────────────────────────────────────────────────────────────
function renderTips(){
  const cats=[...new Set(TIPS.map(t=>t.category))];
  let html=`<div class="mb-24"><h2>Swing Tips</h2><p class="text-dim text-sm" style="margin-top:4px">Key fundamentals for every phase of your swing</p></div>`;
  html+=`<div class="flex gap-8 flex-wrap mb-24">${cats.map(c=>`<button class="phase-btn" style="border-color:${state.tipCategory===c?phaseColors[c]:'#1e3a5f'};background:${state.tipCategory===c?phaseColors[c]+'15':'transparent'};color:${state.tipCategory===c?phaseColors[c]:'#94a3b8'}" onclick="state.tipCategory='${c}';render()">${phaseIcons[c]} ${c}</button>`).join('')}</div>`;
  html+=`<div class="flex flex-col gap-16">`;
  TIPS.filter(t=>t.category===state.tipCategory).forEach(t=>{
    html+=`<div class="card" style="border-left:3px solid ${phaseColors[t.category]}"><div class="flex gap-16" style="align-items:start"><div style="font-size:28px;flex-shrink:0">${t.icon}</div><div><h3 style="margin-bottom:8px">${esc(t.title)}</h3><p class="text-dim text-sm" style="line-height:1.7">${esc(t.tip)}</p></div></div></div>`;
  });
  html+=`</div>`;
  html+=`<div class="card mt-24" style="border-left:3px solid #f59e0b"><h3 style="color:#f59e0b;margin-bottom:12px;font-size:15px">Quick Swing Thought</h3><p style="font-size:16px;font-style:italic;margin-bottom:8px;line-height:1.6">"Swing the handle, not the head. When you focus on moving the grip end of the club, the clubhead will follow with natural speed and lag."</p><p class="text-muted text-xs">Focus on this during your next range session</p></div>`;
  return html;
}

// ─── Stats ───────────────────────────────────────────────────────────
function renderStats(){
  let html=`<h2 class="mb-24">Stats & Analytics</h2>`;
  if(state.rounds.length<2){
    html+=`<div class="card text-center" style="padding:48px"><div style="font-size:48px;margin-bottom:16px">\ud83d\udcca</div><h3 class="mb-8">Need more data</h3><p class="text-dim">Log at least 2 rounds to see your analytics and trends.</p></div>`;
    return html;
  }
  const R=state.rounds;
  const scoreByRound=R.map(r=>({name:formatDate(r.date),diff:r.totalScore-r.totalPar}));
  const puttsData=R.map(r=>({name:formatDate(r.date),putts:r.totalPutts}));
  const fwGirData=R.map(r=>({name:formatDate(r.date),fairways:r.fairwaysHit,gir:r.gir}));

  // Scoring dist
  const allHoles=R.flatMap(r=>r.holeData||[]);
  const dist={};
  allHoles.forEach(h=>{const d=h.score-h.par;const l=d<=-2?'Eagle+':d===-1?'Birdie':d===0?'Par':d===1?'Bogey':d===2?'Double':'Triple+';dist[l]=(dist[l]||0)+1;});
  const distData=['Eagle+','Birdie','Par','Bogey','Double','Triple+'].map(l=>({name:l,count:dist[l]||0}));
  const distClr={'Eagle+':'#facc15',Birdie:'#22c55e',Par:'#3b82f6',Bogey:'#f59e0b',Double:'#ef4444','Triple+':'#7f1d1d'};

  html+=`<div class="grid grid-2 mb-20">`;
  html+=`<div class="card"><h3 class="mb-16" style="font-size:15px">Score vs Par Trend</h3>${makeBarChart(scoreByRound,'diff','name',d=>d.diff<=0?'#22c55e':'#f59e0b',200)}</div>`;
  html+=`<div class="card"><h3 class="mb-16" style="font-size:15px">Scoring Distribution</h3>${makeBarChart(distData,'count','name',d=>distClr[d.name]||'#3b82f6',200)}</div>`;
  html+=`</div>`;

  html+=`<div class="grid grid-2 mb-20">`;
  html+=`<div class="card"><h3 class="mb-16" style="font-size:15px">Putts per Round</h3>${makeLineChart(puttsData,['putts'],['#f59e0b'],'name',200)}</div>`;
  html+=`<div class="card"><h3 class="mb-16" style="font-size:15px">Fairways & GIR</h3>${makeLineChart(fwGirData,['fairways','gir'],['#22c55e','#3b82f6'],'name',200)}</div>`;
  html+=`</div>`;

  // Summary stats row
  const avgScore=(R.reduce((s,r)=>s+r.totalScore,0)/R.length).toFixed(1);
  const avgPuttsS=(R.reduce((s,r)=>s+r.totalPutts,0)/R.length).toFixed(1);
  const avgFWS=(R.reduce((s,r)=>s+(r.fairwaysHit||0),0)/R.length).toFixed(1);
  const avgGIRS=(R.reduce((s,r)=>s+(r.gir||0),0)/R.length).toFixed(1);
  const bestRound=Math.min(...R.map(r=>r.totalScore));
  const worstRound=Math.max(...R.map(r=>r.totalScore));
  html+=`<div class="grid grid-4 mb-20">`;
  html+=statCard('Avg Score',avgScore,'\ud83d\udcca','#3b82f6');
  html+=statCard('Best Round',''+bestRound,'\ud83c\udfc6','#22c55e');
  html+=statCard('Worst Round',''+worstRound,'\ud83d\udcc9','#ef4444');
  html+=statCard('Avg Putts',avgPuttsS,'\ud83c\udfaf','#f59e0b');
  html+=`</div>`;

  // Practice time
  const pracByCat={};
  state.drillSessions.forEach(s=>{pracByCat[s.category]=(pracByCat[s.category]||0)+s.duration;});
  const pracData=Object.entries(pracByCat).map(([name,minutes])=>({name,minutes}));
  if(pracData.length){
    html+=`<div class="card"><h3 class="mb-16" style="font-size:15px">Practice Time by Category</h3>`;
    const max=Math.max(...pracData.map(d=>d.minutes),1);
    pracData.forEach(d=>{
      const pct=(d.minutes/max)*100;
      html+=`<div class="flex items-center gap-12 mb-8"><div style="width:90px;font-size:12px;color:#94a3b8;text-align:right">${esc(d.name)}</div><div style="flex:1;height:20px;background:#0f1d32;border-radius:4px;overflow:hidden"><div style="height:100%;width:${pct}%;background:#a855f7;border-radius:4px;transition:width .5s"></div></div><div style="width:40px;font-size:12px;color:#94a3b8">${d.minutes}m</div></div>`;
    });
    html+=`</div>`;
  }
  return html;
}

// ─── Actions ─────────────────────────────────────────────────────────
function openNewRound(){state.showModal=true;state.courseName='';state.holeCount=18;state.holes=makeHoles();render();}
function closeModal(){state.showModal=false;render();}
function updateHole(i,field,val){state.holes[i][field]=val;render();}
function deleteRound(id){state.rounds=state.rounds.filter(r=>r.id!==id);render();}

function saveRound(){
  const h=state.holes.slice(0,state.holeCount);
  state.rounds.push({id:generateId(),date:new Date().toISOString(),course:state.courseName||'Unknown Course',holes:state.holeCount,holeData:h.map(x=>({...x})),totalScore:h.reduce((s,ho)=>s+ho.score,0),totalPar:h.reduce((s,ho)=>s+ho.par,0),totalPutts:h.reduce((s,ho)=>s+ho.putts,0),fairwaysHit:h.filter(ho=>ho.fairway).length,gir:h.filter(ho=>ho.gir).length});
  state.showModal=false;render();
}

function startDrill(id){
  state.activeDrill=DRILLS.find(d=>d.id===id);
  state.elapsed=0;state.timerRunning=false;state.drillComplete=false;state.rating=3;
  clearInterval(timerInterval);render();
}

function toggleTimer(){
  state.timerRunning=!state.timerRunning;
  clearInterval(timerInterval);
  if(state.timerRunning){timerInterval=setInterval(()=>{state.elapsed++;render();},1000);}
  render();
}

function completeDrill(){state.timerRunning=false;clearInterval(timerInterval);state.drillComplete=true;render();}

function saveDrillSession(){
  const d=state.activeDrill;
  state.drillSessions.push({id:generateId(),drillId:d.id,drillName:d.name,category:d.category,duration:Math.max(1,Math.round(state.elapsed/60)),rating:state.rating,date:new Date().toISOString()});
  state.activeDrill=null;render();
}

function bindEvents(){
  document.querySelectorAll('#nav button[data-page]').forEach(btn=>{
    btn.onclick=()=>{
      state.page=btn.dataset.page;
      if(state.activeDrill){state.activeDrill=null;state.timerRunning=false;clearInterval(timerInterval);}
      render();
    };
  });
}

// ─── Init ────────────────────────────────────────────────────────────
render();
</script>
</body>
</html>
